<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Travel Town Reward Codes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        #status {
            margin-bottom: 15px;
            font-weight: bold;
        }

        h2 {
            margin-top: 20px;
            color: #444;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        a {
            color: #007bff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <h1>üéÅ Travel Town Daily Reward Codes</h1>
    <div id="status">Loading...</div>
    <div id="content"></div>

    <script>
        const JSON_URL = './data/codes.json';

        function formatUpdatedDate(isoString) {
            const date = new Date(isoString);
            const options = { day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
            return date.toLocaleString('en-US', options);
        }

        async function loadCodes() {
            try {
                const res = await fetch(JSON_URL, { cache: 'no-store' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                document.getElementById('status').textContent = `Updated: ${formatUpdatedDate(data.updated_utc)}`;

                // Group entries by date
                const grouped = {};
                data.entries.forEach(entry => {
                    const dateKey = entry.date || 'Unknown Date';
                    if (!grouped[dateKey]) grouped[dateKey] = [];
                    grouped[dateKey].push(entry);
                });

                const contentDiv = document.getElementById('content');
                contentDiv.innerHTML = '';

                Object.keys(grouped).forEach(date => {
                    const heading = document.createElement('h2');
                    heading.textContent = date;
                    contentDiv.appendChild(heading);

                    const table = document.createElement('table');
                    const thead = document.createElement('thead');
                    thead.innerHTML = '<tr><th>Reward</th><th>Link</th></tr>';
                    table.appendChild(thead);

                    const tbody = document.createElement('tbody');
                    grouped[date].forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${entry.reward || ''}</td><td><a href="${entry.url}" target="_blank" rel="noopener">Redeem</a></td>`;
                        tbody.appendChild(row);
                    });
                    table.appendChild(tbody);
                    contentDiv.appendChild(table);
                });
            } catch (err) {
                document.getElementById('status').textContent = 'Failed to load codes: ' + err.message;
            }
        }

        loadCodes();
    </script>
</body>

</html>
